<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP&family=Noto+Serif&display=swap" rel="stylesheet">
    <<style>
        body {
        font-family: 'Noto Serif', serif;
        text-align: center;
        }

        tr.spaceUnder>td {
        padding-bottom: 0.5em;
        }
        </style>
</head>

<body>

    <div style="width:700px; margin:0 auto;" ng-app="sizeEstimation_app" ng-controller="mainController"
        ng-init="sheets_per_packet=100;gsm=300; card_length=9.5; card_width=8.5; card_qty=1000; boxes_per_lw=1; pkr_per_kg=210; ">
        <h1>Size and cost analysis</h1>
        <table>
            <tr class="spaceUnder">
                <td style="text-align:right">
                    <label for="card_length">Length: &nbsp;&nbsp;</label>
                </td>

                <td style="text-align:left">
                    <input id="card_length" type="number" ng-model="card_length" placeholder="Inches"
                        ng-bind="card_length" ng-change="mainFunction()">
                </td>
            </tr>

            <tr class="spaceUnder">
                <td style="text-align:right">
                    <label for="card_width">Width: &nbsp;&nbsp;</label>
                </td>
                <td style="text-align:left">
                    <input id="card_width" type="number" ng-model="card_width" placeholder="Inches"
                        ng-bind="card_width" ng-change="mainFunction()">
                </td>
            </tr>

            <tr class="spaceUnder">
                <td style="text-align:right">
                    <label for="card_qty">Total Quantity: &nbsp;&nbsp;</label>
                </td>
                <td style="text-align:left">
                    <input id="card_qty" type="number" ng-model="card_qty" placeholder="Integer" ng-bind="card_qty" ng-change="mainFunction()">
                </td>
            </tr>

            <tr class="spaceUnder">
                <td style="text-align:right">
                    <label for="boxes_per_lw">Number of pieces on the plate:&nbsp;&nbsp;</label>
                </td>
                <td style="text-align:left">
                    <input id="boxes_per_lw" type="number" ng-model="boxes_per_lw" placeholder="e.g., 1 up or 2 up"
                        ng-bind="boxes_per_lw" ng-change="mainFunction()">
                </td>
            </tr>

            <tr class="spaceUnder">
                <td style="text-align:right">
                    <label for="pkr_per_kg">Cost per Kg:&nbsp;&nbsp;</label>
                </td>
                <td style="text-align:right">
                    <input id="pkr_per_kg" type="number" ng-model="pkr_per_kg" placeholder="PKR" ng-bind="pkr_per_kg" ng-change="mainFunction()">
                </td>
            </tr>

            <tr class="spaceUnder">
                <td style="text-align:right">
                    <label for="gsm">GSM (grams per square meter):&nbsp;&nbsp;</label>
                </td>
                <td style="text-align:right">
                    <input id="gsm" type="number" ng-model="gsm" placeholder="Number" ng-bind="gsm"
                        placeholder="Integer" ng-change="mainFunction()">
                </td>
            </tr>

            <tr class="spaceUnder">
                <td style="text-align:right">
                    <label for="sheets_per_packet">Number of sheets per packet:&nbsp;&nbsp;</label>
                </td>
                <td style="text-align:right">
                    <input type="number" id="sheets_per_packet" ng-model="sheets_per_packet" ng-bind="sheets_per_packet"
                        placeholder="Integer" ng-change="mainFunction()">
                </td>
            </tr>

            <tr class="spaceUnder">
                <td>
                </td>
                <td style="text-align:right">
                    <button type="button" ng-click="mainFunction()">Calculate</button>
                </td>
            </tr>
        </table>


        <table>
            <tr>
                <td style="text-align:right"> Packet Size: &nbsp;&nbsp; </td>
                <td style="text-align:left"> {{sz}} </td>
            </tr>

            <tr>
                <td style="text-align:right"> Number of packets required: &nbsp;&nbsp; </td>
                <td style="text-align:left"> {{req_pck_num}} </td>
            </tr>

            <tr>
                <td style="text-align:right"> Output quantity: &nbsp;&nbsp; </td>
                <td style="text-align:left"> <span id='number-default'>{{output_qty | number:0}}</span> </td>
            </tr>

            <tr>
                <td style="text-align:right"> Output quantity per packet: &nbsp;&nbsp; </td>
                <td style="text-align:left"> <span id='number-default'>{{output_qty_per_pck | number:0}}</span> </td>
            </tr>


            <tr>
                <td style="text-align:right"> Cost per packet: &nbsp;&nbsp; </td>
                <td style="text-align:left"> <span id='number-default'> {{cost_per_pck | number:0}}</span> PKR </td>
            </tr>

            <tr>
                <td style="text-align:right"> Total estimated cost: &nbsp;&nbsp; </td>
                <td style="text-align:left"> <span id='number-default'> {{total_cost | number:0}}</span> PKR </td>
            </tr>

            <tr>
                <td style="text-align:right"> Cost per piece: &nbsp;&nbsp; </td>
                <td style="text-align:left"> <span id='number-default'> {{cost_per_piece | number:6}}</span> PKR </td>
            </tr>


        </table>



    </div>

    <script>
        var app = angular.module('sizeEstimation_app', []);
        app.controller('mainController', function ($scope) {
            szs = [
                [20, 30],
                [30, 20],
                [22, 28],
                [28, 22],
                [23, 36],
                [36, 23],
                [25, 30],
                [30, 25],
                [25, 36],
                [36, 25],
                [31, 43],
                [43, 31],
                [30, 50],
                [50, 30],
            ];





            $scope.mainFunction = function () {
                var params = {
                    card_length: card_length.value, card_width: card_width.value,
                    card_qty: card_qty.value, boxes_per_lw: boxes_per_lw.value,
                    pkr_per_kg: pkr_per_kg.value, gsm: gsm.value,
                    sheets_per_packet: sheets_per_packet.value,
                    szs: szs
                };
                res = cl_packet_size(params);
                $scope.sz = res.sz;
                $scope.req_pck_num = res.req_pck_num;
                $scope.output_qty = res.output_qty;
                $scope.output_qty_per_pck = res.output_qty_per_pck;
                $scope.cost_per_pck = res.cost_per_pck;
                $scope.total_cost = res.total_cost;
                $scope.cost_per_piece = res.cost_per_piece;

            }
        });

        function cl_packet_size(x) {
            ns = [];
            minima = Number.POSITIVE_INFINITY; ind = 1;
            for (it = 0; it < x.szs.length; it++) {
                ns[ns.length] = [x.szs[it][0] / x.card_length, x.szs[it][1] / x.card_width];

                // wastage per sheet
                l_wastage = x.szs[it][0] - Math.floor(ns[it][0]) * x.card_length;
                w_wastage = x.szs[it][1] - Math.floor(ns[it][1]) * x.card_width;

                e_L = l_wastage * x.szs[it][1];
                e_R = w_wastage * x.szs[it][0];

                wastage = e_L + e_R - l_wastage * w_wastage;

                pck_cnt = x.card_qty / (Math.floor(ns[it][0]) * Math.floor(ns[it][1]) * x.boxes_per_lw * x.sheets_per_packet);
                req_pck_num = Math.ceil(pck_cnt);
                output_qty = req_pck_num * x.sheets_per_packet * Math.floor(ns[it][0]) * Math.floor(ns[it][1]) * x.boxes_per_lw;

                wastage = wastage / output_qty;
                temp = wastage * pck_cnt * x.sheets_per_packet * (1 / 1550.00310) * (x.gsm / 1000) * x.pkr_per_kg;

                if (temp < minima) {
                    minima = temp;
                    ind = it;

                    sz_min = szs[ind];
                    ns_min = ns[ind];

                    req_pck_num_min = req_pck_num;
                    output_qty_min = output_qty;

                    output_qty_per_pck = output_qty / req_pck_num;

                    cost_per_pck = x.pkr_per_kg * x.sheets_per_packet * (x.gsm / 1000) * sz_min[0] * sz_min[1] * (1 / 1550.00310);
                    total_cost = req_pck_num * cost_per_pck;
                    cost_per_piece = total_cost / output_qty; //round(total_cost/output_qty,8);

                    y = {
                        ind: ind, ns: ns_min, sz: sz_min, minima: minima, req_pck_num: req_pck_num_min, output_qty: output_qty_min,
                        output_qty_per_pck: output_qty_per_pck, cost_per_pck: cost_per_pck, total_cost: total_cost, cost_per_piece: cost_per_piece
                    };

                }
            }
            console.log(x.card_length);
            console.table(szs);
            console.table(ns);
            return y;
        }

    </script>
</body>

</html>